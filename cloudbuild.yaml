steps:
  # Step 1: Build the Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/lists-on-lists', '.']
  
  # Step 2: Push the image to Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/lists-on-lists']
  
  # Step 3: Update the image reference in cloudrun.yaml
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        sed -i "s|image:.*|image: gcr.io/$PROJECT_ID/lists-on-lists|g" cloudrun.yaml
  
  # Step 4: Deploy using cloudrun.yaml
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args:
      - 'run'
      - 'services'
      - 'replace'
      - 'cloudrun.yaml'
      - '--region'
      - 'us-central1'

# Store the built image
images:
  - 'gcr.io/$PROJECT_ID/lists-on-lists'

# Optional: Set timeout (default is 10 minutes)
timeout: '1200s'